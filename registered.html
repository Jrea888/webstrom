<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>网上预约挂号系统</title>
</head>
<link rel="stylesheet" href="./styles/common.css">
<link rel="stylesheet" href="./styles/index.css">
<style type="text/css">
    .bonds {
        border: 1px solid #CCC;
        text-align: left;
        font-size: 16px;
        font-weight: 700;
    }
</style>
<body>
<div id="login">
    <div class="top">
        <img src="./images/topimg.jpg" alt="">
    </div>
    <div class="heng"></div>
    <div class="nav">
        <ul>
            <li><a href="./index.html">系统首页</a></li>
            <li><a href="./doctorEnquiry.html">医生查询</a></li>
            <li><a href="./online.html">在线预约</a></li>
            <li><a href="publicInfo.html">公告信息</a></li>
            <li><a href="./registered.html">患者注册</a></li>
        </ul>
    </div>

    <div class="content clearfix">
        <div class="leftHuan fl ">
            <div class="listHuan">
                <div class="listTop">
                    <div class="text">
                        <span>患者注册</span>
                    </div>
                </div>
                <div class="listBottom clearfix">
                    <table class="rightPartContent" width="100%" cellpadding="0" cellspacing="0" border="0"
                           align="center">
                        <tr>
                            <td class="bond">账号：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="Identitied" v-model="Identity" type="text">
                                <span>{{errorIdentity}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond">密码：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="Pass" v-model="patientPass" type="password">
                                <span>{{errorPass}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond">姓名：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="patUser" v-model="patientName" type="text">
                                <span>{{errorUser}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond">住址：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="patAddress" v-model="patientAddress" type="text">
                                <span>{{errorAddress}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond">电话：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="patPhone" v-model="patientPhone" type="text">
                                <span>{{errorPhone}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond">邮箱：</td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun" v-on:blur="patPost" v-model="patientPost" type="text">
                                <span>{{errorPost}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="bond"></td>
                            <td style="text-align: left;padding: 0 3%;">
                                <input class="haun patient" @click="patientConfirm" type="button" value="确定">
                                <input class="haun patient" @click="patientReset" type="button" value="重置">
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="right fr">
            <div class="login" id="loginInput">
                <ul>
                    <li>
                        账号：<input class="zhHao" v-on:blur="checkUser" v-model="userLoginName"  type="text" placeholder="请输入用户名">
                    </li>
                    <p>{{errorLoginUser}}</p>
                    <li>
                        密码：<input class="zhHao" v-on:blur="checkPass" v-model="passLoginWord" type="password" placeholder="请输入密码">
                    </li>
                    <p>{{errorLoginPass}}</p>
                    <li>
                        <input class="btn" type="button" @click="checkLogin" value="登录">
                        <input class="btn" type="button" @click="Register" value="注册">
                    </li>
                </ul>
            </div>
            <div class="userInfo" id="username">
                <ul>
                    <li>
                        <span>欢迎您：</span>
                        <span id="realUser">admin</span>
                    </li>
                    <li>
                        <a href="">注销退出</a>
                    </li>
                    <li>
                        <a href="">管理中心</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="font">
        <p>联系方式&nbsp;电话：18142422763&nbsp;&nbsp;&nbsp;</p>
        <p>地址：陕西省咸阳市XXXXXX厦A区305号</p>
    </div>

</div>


<script type="text/javascript" src="./script/vue.js"></script>
<script type="text/javascript" src="./script/jquery.js"></script>
<script type="text/javascript" src="script/toolJs.js"></script>
<script type="text/javascript" src="script/axios.min.js"></script>
<script type="text/javascript" src="script/constants.js"></script>
<script type="text/javascript" src="script/httpRequest.js"></script>
<script type="text/javascript">
    //显示用户是否登录
    $(function () {
        show();
    });
    //登录成功 显示真实用户
    document.getElementById("realUser").innerHTML = show();


    new Vue({
        el: '#login',
        data() {
            //数据双向绑定
            return {
                //患者注册信息
                Identity: '',
                patientPass: '',
                patientName: '',
                patientAddress: '',
                patientPhone: '',
                patientPost: '',
                //用户登录信息
                userLoginName: '',
                passLoginWord: '',
                errorLoginUser:'',
                errorLoginPass:'',
                //患者注册信息校验
                errorIdentity: '',
                errorPass: '',
                errorUser: '',
                errorAddress:'',
                errorPhone:'',
                errorPost:''
            }
        },
        methods: {
            //非空校验
            Identitied() {
                //校验是否有注册过的账号
                if (this.Identity) {
                    this.errorIdentity = "";
                } else {
                    this.errorIdentity = "账号不能为空"
                }
            },
            Pass() {
                if (this.patientPass) {
                    this.errorPass = "";
                } else {
                    this.errorPass = "密码不能为空"
                }
            },
            patUser() {
                if (this.patientName) {
                    this.errorUser = "";
                } else {
                    this.errorUser = "姓名不能为空"
                }
            },
            patAddress(){
                if (this.patientAddress) {
                    this.errorAddress = "";
                } else {
                    this.errorAddress = "住址不能为空"
                }
            },
            patPhone(){
                if (this.patientPhone) {
                    this.errorPhone = "";
                    var phone = /^1(3|4|5|7|8)\d{9}$/;//手机号校验
                    if (phone.test(this.patientPhone)) {
                        this.errorPhone = "";
                    }else{
                        this.errorPhone = "电话号码格式不正确"
                    }
                } else {
                    this.errorPhone = "电话不能为空"
                }
            },
            patPost(){

                if (this.patientPost) {
                    this.errorPost = "";
                    var reg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;
                    // var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");
                    if (reg.test(this.patientPost)) {
                        this.errorPost = "";
                    }else{
                        this.errorPost = "邮箱格式不正确";
                    }
                } else {
                    this.errorPost = "邮箱不能为空"
                }
            },
            //患者注册请求发送
            patientConfirm() {
                var registerData = {
                    userName: this.Identity,
                    userPw: this.patientPass,
                    userRealname: this.patientName,
                    userAddress: this.patientAddress,
                    userTel: this.patientPhone,
                    userEmail: this.patientPost,
                };
                if (this.Identity &&
                    this.patientPass &&
                    this.patientName &&
                    this.patientAddress &&
                    this.patientPhone &&
                    this.patientPost) {
                    $.ajax({
                        type: "post",
                        url: getUrl() + '/out/api/registered',
                        data: registerData,
                        dataType: "json",
                        success: function (result) {
                            if (result.code === 0) {//注册成功
                                alert(result.msg);
                                // parent.location.href = '/hospital/index.html'
                            }
                            if (result.code === 401) {
                                alert(result.msg+"注册失败")
                            }
                        }
                    });
                } else {
                    alert("信息不能为空");
                }
            },
            //重置
            patientReset() {
                this.Identity = "";
                this.patientPass = "";
                this.patientName = "";
                this.patientAddress = "";
                this.patientPhone = "";
                this.patientBox = "";
            },
            //用户登录校验
            checkUser(){
                if (this.userLoginName){
                    this.errorLoginUser = ""
                }else{
                    this.errorLoginUser= "账号不能为空";
                }
            },
            checkPass(){
                if (this.passLoginWord && this.passLoginWord.length === 6){
                    this.errorLoginPass = ""
                }else{
                    this.errorLoginPass= "密码不能为空 长度必须为六位";
                }
            },
            //用户登录部分
            checkLogin() {
                if (this.userLoginName && this.passLoginWord) {
                    var loginData = {
                        userName: this.userLoginName,
                        password: this.passLoginWord
                    };
                    $.ajax({
                        type: "POST",
                        url: getUrl() + "/sys/login",
                        data: loginData,
                        dataType: "json",
                        success: function (result) {
                            if (result.code == 0) {//登录成功
                                localStorage.setItem("token", result.token);
                                localStorage.setItem("userLoginName", this.userLoginName);
                                parent.location.href = '/hospital/index.html';
                            }
                            if (result.code == 500) {
                                alert(result.msg)
                            }
                        },
                        error: function () {
                            alert("请求失败")
                        }
                    });
                } else {
                    alert("用户和密码不能为空")
                }
            },
            //注册
            Register() {
                parent.location.href = '/hospital/registered.html';
            }
        }
    })
</script>

</body>
</html>